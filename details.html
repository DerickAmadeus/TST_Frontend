<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Details - AnimeSync</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #121212;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: #1e1e1e;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #333;
        }

        .header h1 {
            font-size: 2.5em;
            color: #e91e63;
            margin-bottom: 10px;
        }

        .anime-detail {
            background: #1e1e1e;
            border-radius: 12px;
            border: 1px solid #333;
            overflow: hidden;
            margin-bottom: 40px;
            display: none;
        }

        .anime-detail.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .anime-hero {
            display: flex;
            padding: 30px;
            gap: 30px;
            background: #252525;
        }

        .anime-image {
            width: 225px;
            height: 318px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #444;
        }

        .anime-info {
            flex: 1;
        }

        .anime-title {
            font-size: 2.2em;
            margin-bottom: 15px;
            color: #fff;
        }

        .anime-stats {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            padding: 15px;
            background: #1e1e1e;
            border-radius: 8px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 600;
            color: #e91e63;
        }

        .score-large {
            font-size: 2.5em !important;
            color: #ffd700;
        }

        .anime-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .meta-item {
            background: #333;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        .meta-label {
            font-size: 0.8em;
            color: #aaa;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .meta-value {
            font-size: 1.1em;
            font-weight: 500;
            color: #fff;
        }

        .genres {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .genre-tag {
            background: #444;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            color: #ccc;
            border: 1px solid #555;
        }

        .synopsis-section {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #333;
        }

        .synopsis-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #e91e63;
        }

        .recommendations {
            margin-top: 30px;
        }

        .section-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #e91e63;
            padding: 15px;
            background: #1e1e1e;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .recommendation-card {
            background: #252525;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #444;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(233, 30, 99, 0.3);
            border-color: #e91e63;
        }

        .rec-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .rec-content {
            padding: 15px;
        }

        .rec-title {
            font-size: 1.1em;
            margin-bottom: 8px;
            line-height: 1.3;
            color: #fff;
        }

        .rec-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .similarity-score {
            background: #e91e63;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .matched-genres {
            font-size: 0.8em;
            color: #aaa;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #aaa;
        }

        .spinner {
            border: 3px solid #333;
            border-top: 3px solid #e91e63;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #2a1a1a;
            border: 1px solid #5a2a2a;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            color: #ff6b6b;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #333;
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            border: 1px solid #444;
        }

        .back-btn:hover {
            background: #444;
            transform: translateX(-5px);
        }

        @media (max-width: 768px) {
            .anime-hero {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .anime-image {
                width: 200px;
                height: 280px;
            }

            .anime-stats {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">
            <i>‚Üê</i> Back to Library
        </a>

        <div class="header">
            <h1>üé¨ Anime Details</h1>
            <p>Discover detailed information and get personalized recommendations</p>
        </div>

        <div id="anime-detail" class="anime-detail">
            loadAnimeDetail();
        </div>

        <div id="recommendations" class="recommendations" style="display: none;">
            <div class="section-title">
                <span>üéØ</span>
                Recommended for You
            </div>
            <div id="recommendations-grid" class="recommendations-grid">
                <!-- Rekomendasi akan dimuat di sini -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE = "https://udinbanda.theokaitou.my.id";
        let currentAnimeId = null;

        // Auto-load anime from URL parameter
        async function autoLoadAnime() {
            const urlParams = new URLSearchParams(window.location.search);
            const animeId = urlParams.get('id');
            
            if (!animeId) {
                document.getElementById('anime-detail').innerHTML = `
                    <div class="error">
                        <h3>‚ùå No Anime ID Provided</h3>
                        <p>This page should be accessed from the main library.</p>
                        <a href="index.html" style="color: #e91e63; text-decoration: underline;">‚Üê Go back to library</a>
                    </div>
                `;
                document.getElementById('anime-detail').classList.add('show');
                return;
            }

            const detailContainer = document.getElementById('anime-detail');
            const recommendationsContainer = document.getElementById('recommendations');
            
            // Show loading
            detailContainer.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Loading anime details...
                </div>
            `;
            detailContainer.classList.add('show');
            recommendationsContainer.style.display = 'none';

            try {
                // Fetch anime detail
                const response = await fetch(`${API_BASE}/anime/${animeId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.message === 'success' && data.data) {
                    currentAnimeId = animeId;
                    displayAnimeDetail(data.data);
                    loadRecommendations(animeId);
                } else {
                    throw new Error('Anime not found');
                }
                
            } catch (error) {
                console.error('Error loading anime detail:', error);
                detailContainer.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error Loading Anime</h3>
                        <p>${error.message}</p>
                        <p>Please try again or go back to the library.</p>
                        <a href="index.html" style="color: #e91e63; text-decoration: underline;">‚Üê Go back to library</a>
                    </div>
                `;
            }
        }

        function displayAnimeDetail(anime) {
            const container = document.getElementById('anime-detail');
            const imageUrl = anime.image_url || 'https://via.placeholder.com/225x318/333/fff?text=No+Image';
            
            const genres = Array.isArray(anime.genres) ? anime.genres : [];
            const genreTags = genres.map(genre => 
                `<span class="genre-tag">${genre}</span>`
            ).join('');

            // Calculate some mock stats for MyAnimeList-style display
            const mockRank = Math.floor(Math.random() * 1000) + 1;
            const mockPopularity = Math.floor(Math.random() * 5000) + 100;
            const mockMembers = Math.floor(Math.random() * 100000) + 10000;

            container.innerHTML = `
                <div class="anime-hero">
                    <img src="${imageUrl}" alt="${anime.title}" class="anime-image" 
                         onerror="this.src='https://via.placeholder.com/225x318/333/fff?text=No+Image'">
                    
                    <div class="anime-info">
                        <h2 class="anime-title">${anime.title}</h2>
                        
                        <!-- MyAnimeList Style Stats -->
                        <div class="anime-stats">
                            <div class="stat-item">
                                <div class="stat-label">SCORE</div>
                                <div class="stat-value score-large">${anime.score || 'N/A'}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">RANKED</div>
                                <div class="stat-value">#${mockRank}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">POPULARITY</div>
                                <div class="stat-value">#${mockPopularity}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">MEMBERS</div>
                                <div class="stat-value">${mockMembers.toLocaleString()}</div>
                            </div>
                        </div>
                        
                        <div class="anime-meta">
                            <div class="meta-item">
                                <div class="meta-label">Type</div>
                                <div class="meta-value">${anime.type || 'Unknown'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Episodes</div>
                                <div class="meta-value">${anime.episodes || '?'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Status</div>
                                <div class="meta-value">${anime.status || 'Unknown'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Source</div>
                                <div class="meta-value">${anime.source || 'Unknown'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Duration</div>
                                <div class="meta-value">${anime.duration || 'Unknown'}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Rating</div>
                                <div class="meta-value">${anime.rating || 'Unknown'}</div>
                            </div>
                        </div>

                        ${genres.length > 0 ? `
                        <div>
                            <div class="meta-label" style="margin-bottom: 10px; font-size: 1em;">Genres</div>
                            <div class="genres">${genreTags}</div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                ${anime.synopsis ? `
                <div class="synopsis-section">
                    <div class="synopsis-title">Synopsis</div>
                    <p style="line-height: 1.6; color: #ccc;">${anime.synopsis}</p>
                </div>
                ` : ''}
            `;
        }

        // Load recommendations
        async function loadRecommendations(animeId) {
            const recommendationsContainer = document.getElementById('recommendations');
            const gridContainer = document.getElementById('recommendations-grid');
            
            recommendationsContainer.style.display = 'block';
            gridContainer.innerHTML = `
                <div style="grid-column: 1 / -1;" class="loading">
                    <div class="spinner"></div>
                    Loading recommendations...
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE}/recommend/${animeId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.recommendations && data.recommendations.length > 0) {
                    displayRecommendations(data.recommendations, data.source);
                } else {
                    gridContainer.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; color: #aaa; padding: 40px;">
                            <p>No recommendations found for this anime.</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading recommendations:', error);
                gridContainer.innerHTML = `
                    <div style="grid-column: 1 / -1;" class="error">
                        <h4>‚ùå Failed to load recommendations</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function displayRecommendations(recommendations, source) {
            const container = document.getElementById('recommendations-grid');
            
            container.innerHTML = recommendations.map(anime => {
                const imageUrl = anime.image_url || 'https://via.placeholder.com/220x180/333/fff?text=No+Image';
                const matchedGenres = anime.matched_genres || [];
                const matchedText = matchedGenres.length > 0 
                    ? `Matched: ${matchedGenres.join(', ')}` 
                    : 'Similar content';

                return `
                    <div class="recommendation-card" onclick="loadSpecificAnime(${anime.animeID})">
                        <img src="${imageUrl}" alt="${anime.title}" class="rec-image" 
                             onerror="this.src='https://via.placeholder.com/220x180/333/fff?text=No+Image'">
                        <div class="rec-content">
                            <h4 class="rec-title">${anime.title}</h4>
                            <div class="rec-score">
                                <span class="score-display">‚≠ê ${anime.score || 'N/A'}</span>
                                <span class="similarity-score">${anime.similarity_score.toFixed(1)}</span>
                            </div>
                            <div class="matched-genres">${matchedText}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load specific anime dari rekomendasi
        function loadSpecificAnime(animeId) {
            // Redirect to new page with anime ID
            window.location.href = `details.html?id=${animeId}`;
        }

        // Auto-load on page load
        window.addEventListener('DOMContentLoaded', () => {
            autoLoadAnime();
        });
    </script>
</body>
</html>
